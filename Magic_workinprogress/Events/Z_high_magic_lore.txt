namespace = high_magic_lore

character_event = {
	id = high_magic_lore.99990
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		save_event_target_as = magic_caster
		set_character_flag = high_magic
		if = {
			limit = {
				has_character_modifier = magic_power_1
			}
			set_variable = { which = "spell_power" value = 1}
		}
		if = {
			limit = {
				has_character_modifier =  magic_power_2
			}
			set_variable = { which = "spell_power" value = 2}
		}
		if = {
			limit = {
			has_character_modifier = magic_power_3
			}
			set_variable = { which = "spell_power" value = 3}
		}
		if = {
			limit = {
			has_character_modifier = magic_power_4
			}
		set_variable = { which = "spell_power" value = 4}
		}
		if = {
			limit = {
				trait = creature_elf
				culture_group = asur_group
			}
			change_variable = { which = "spell_power" value = 1}
		}	
		if = {
			limit = {
				trait = loremaster
			}
			change_variable = { which = "spell_power" value = -2}
		}			
		any_current_enemy = {
			random_realm_character = {
				limit = {
					in_command = yes				
					at_location = ROOT 
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4									
					}	
					NOT = { has_character_modifier =  magic_cooldown }
				}
				save_event_target_as = magic_dispeler
				if = {
					limit = {
						has_character_modifier =  magic_power_1
					}
					set_variable = { which = "spell_power" value = 1}
				}
				if = {
					limit = {
						has_character_modifier =  magic_power_2
					}
					set_variable = { which = "spell_power" value = 2}
				}
				if = {
					limit = {
						has_character_modifier = magic_power_3
					}
					set_variable = { which = "spell_power" value = 3}
				}
				if = {
					limit = {
						has_character_modifier = magic_power_4
					}
					set_variable = { which = "spell_power" value = 4}
				}	
			}
		}
		long_character_event = { id = high_magic_lore.1}
	}
}

long_character_event = {
	id = high_magic_lore.1#"High Magic" 
	desc = high_magic_lore.1_desc#"High Magic, the true magic. "
	is_triggered_only = yes
	
	picture = GFX_evt_mage_lore_high_magic
	


	option = {
	trigger = {check_variable = { which = "spell_power" value = 1}}
		name = high_magic_lore.1a#"High Magic; Drain Magic"
		character_event = {id = high_magic_lore.1000}
	}
	option = {
	trigger = {check_variable = { which = "spell_power" value = 1}}	
		name = high_magic_lore.1b#"High Magic; Soul Quench"
		character_event = {id = high_magic_lore.2000}
	}
	option = {
	trigger = {check_variable = { which = "spell_power" value = 2}}	
		name = high_magic_lore.1c#"High Magic; Apotheosis"
		character_event = {id = high_magic_lore.3000}
	}
	option = {
	trigger = {check_variable = { which = "spell_power" value = 3}}	
		name = high_magic_lore.1d#"High Magic; Fiery Convocation "
		character_event = {id = high_magic_lore.4000}
	}	
}


#Drain Magic


character_event = {
	id = high_magic_lore.1000#"High Magic; Drain Magic" 
	desc = high_magic_lore.1000_desc#"You prepare your powers and strike out with your arcane arts, ripping the very essence of enchantment away from your enemies. Select the strength you wish to cast with, tier 1 will stop a random enemy spellcaster. tier 2 will affect three enemy spell casters. Tier three will affect all enemy spell casters. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 1}}
		name = high_magic_lore.1000a#"High Magic; Drain Magic Power 1"
		character_event = {id = high_magic_lore.1100}
		set_character_flag = high_magic_drain_1
	}
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 2}}
		name = high_magic_lore.1000b#"High Magic; Drain Magic Power 2"
		character_event = {id = high_magic_lore.1200}
		set_character_flag = high_magic_drain_2
	}
	option = {
		trigger = {check_variable = { which = "spell_power" value = 4}}
		name = high_magic_lore.1000c#"High Magic; Drain Magic Power 3"
		character_event = {id = high_magic_lore.1300}
		set_character_flag = high_magic_drain_3
	}
}

character_event = {
	id = high_magic_lore.1100#"High Magic; Drain Magic" 
	desc = high_magic_lore.1100_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	
	immediate = {
		change_variable = {which = "spell_power" value = -1}
		set_variable = { which = miscast_power value = 1 }
		random_list = {
			90 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}			
			}
			10 = {  
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.1100a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.11111}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}
character_event = {
	id = high_magic_lore.11111#Drain Magic Power 1" 
	desc = high_magic_lore.11111_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes
		location = {
			add_province_modifier = { modifier = magic_drain days = 10 }
		}	
		any_current_enemy = {
			random_realm_character = {
				limit = {
					at_location = ROOT
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4	
					}
					not = {
						has_character_modifier = magic_cooldown
					}
				}
				add_character_modifier = { modifier = magic_cooldown days = 200 }
				
			}
		}
	}
	
	option = {
		name = high_magic_lore.11111a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.1121b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}





character_event = {
	id = high_magic_lore.1200#"High Magic; Drain Magic" 
	desc = high_magic_lore.1200_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -2}
		set_variable = { which = miscast_power value = 2 }
		random_list = {
			75 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}			
			}
			25 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.1200#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.11112}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.11112#Drain Magic Power 2" 
	desc = high_magic_lore.11112_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
	clear_spell_effect = yes
		location = {
			add_province_modifier = { modifier = magic_drain days = 10 }
		}
		random_current_enemy = {
			random_realm_character = {
				limit = {
					at_location = ROOT
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4	
					}
					not = {
						has_character_modifier = magic_cooldown
					}
				}
				add_character_modifier = { modifier = magic_cooldown days = 200 }
				
			}
		}
		random_current_enemy = {
			random_realm_character = {
				limit = {
					at_location = ROOT
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4	
					}
					not = {
						has_character_modifier = magic_cooldown
					}
				}
				add_character_modifier = { modifier = magic_cooldown days = 200 }
				
			}
		}
		random_current_enemy = {
			random_realm_character = {
				limit = {
					at_location = ROOT
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4	
					}
					not = {
						has_character_modifier = magic_cooldown
					}
				}
				add_character_modifier = { modifier = magic_cooldown days = 200 }
				
			}
		}		
	}
	
	option = {
		name = high_magic_lore.11112a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.11112b#No
		character_event = {id = magic_system.99997}
	}
}




character_event = {
	id = high_magic_lore.1300#"High Magic; Drain Magic" 
	desc = high_magic_lore.1300_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -4}
		set_variable = { which = miscast_power value = 3 }
		random_list = {
			60 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}
			}
			40 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.1300#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.11113}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.11113#Drain Magic Power 1" 
	desc = high_magic_lore.11113_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
	clear_spell_effect = yes
		location = {
			add_province_modifier = { modifier = magic_drain  days = 30 }
		}
		any_current_enemy = {
			any_realm_character = {
				limit = {
					at_location = ROOT
					or = {
						has_character_modifier = magic_power_1	
						has_character_modifier = magic_power_2	
						has_character_modifier = magic_power_3	
						has_character_modifier = magic_power_4	
					}
					not = {
						has_character_modifier = magic_cooldown
					}
				}
				add_character_modifier = { modifier = magic_cooldown days = 300 }
				
			}
		}
	}
	
	option = {
		name = high_magic_lore.11111a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.11111b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}





#soul quench


character_event = {
	id = high_magic_lore.2000#"High Magic; Soul Quench" 
	desc = high_magic_lore.2000_desc#"Cast your powers and strike down your enemies with the fires that burn the very soul!"
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	option = {
		trigger = {check_variable = { which = "spell_power" value = 1}}
		name = high_magic_lore.2000a#"High Magic; Soul Quench 1"
		character_event = {id = high_magic_lore.2100}
		set_character_flag = high_magic_soul_quench_1
	}
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 2}}
		name = high_magic_lore.2000b#"High Magic; Soul Quench Power 2"
		character_event = {id = high_magic_lore.2200}
		set_character_flag = high_magic_soul_quench_2
	}
	option = {
		trigger = {check_variable = { which = "spell_power" value = 3}}
		name = high_magic_lore.2000c#"High Magic; Soul Quench Power 3"
		character_event = {id = high_magic_lore.2300}
		set_character_flag = high_magic_soul_quench_3
	}
}

character_event = {
	id = high_magic_lore.2100#"High Magic; Soul Quench" 
	desc = high_magic_lore.2100_desc#"You channel the arcane powers and lash out towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -1}
		set_variable = { which = miscast_power value = 1 }
		random_list = {
			90 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}
			}
			10 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.2100a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.21111}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.21111#Soul Quench 1" 
	desc = high_magic_lore.21111_desc#"Your power consumes the life of your chosen target "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
	clear_spell_effect = yes
#		location = {
#			add_province_modifier = { modifier = magic_drain  days = 10 }
#		}	
			 random_current_enemy = {
				limit = { any_army = { location = root } }
				morale = -0.07
				troops = -0.07
			}
	}
	
	option = {
		name = high_magic_lore.21111a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.21111b#No
		character_event = {id = magic_system.99997}
	}
}





character_event = {
	id = high_magic_lore.2200#"High Magic; Drain Magic" 
	desc = high_magic_lore.2200_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -2}
		set_variable = { which = miscast_power value = 2 }
		random_list = {
			75 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}    				
			}
			25 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.2200a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.21112}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.21112#Soul Quench 2" 
	desc = high_magic_lore.11112_desc#"Your spell burns through the air, strike dead scores of men. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
	clear_spell_effect = yes
#		location = {
#			add_province_modifier = { modifier = magic_drain  days = 10 }
#		}
			 random_current_enemy = {
				limit = {
					any_army = {
						location = root
					}
				}
				morale = -0.15
				troops = -0.15
			}		
	}
	
	option = {
		name = high_magic_lore.21112a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.21112b#No
		character_event = {id = magic_system.99997}
	}
}




character_event = {
	id = high_magic_lore.2300#"High Magic; Soul Quench 3" 
	desc = high_magic_lore.2300_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -3}
		set_variable = { which = miscast_power value = 3 }
		random_list = {
			60 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}    				
			}
			40 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.2300a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.21113}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}
character_event = {
	id = high_magic_lore.21113#Drain Magic Power 1" 
	desc = high_magic_lore.21113_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
	clear_spell_effect = yes
#		location = {
#			add_province_modifier = { modifier = magic_drain days = 30 }
#		}
			 random_current_enemy = {
				limit = {
					any_army = {
						location = ROOT
					}
				}
				morale = -0.4
				troops = -0.4
			}
	}
	
	option = {
		name = high_magic_lore.21113a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.21113b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}














character_event = {
	id = high_magic_lore.3000#"High Magic; Apotheosis" 
	desc = high_magic_lore.3000_desc	# You prepare your magic to restore the fallen
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 2}}
		name = high_magic_lore.3000a#"High Magic; Drain Magic Power 1"
		character_event = {id = high_magic_lore.3100}
		set_character_flag = high_magic_apotheosis_1
	}
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 3}}
		name = high_magic_lore.3000b#"High Magic; Drain Magic Power 2"
		character_event = {id = high_magic_lore.3200}
		set_character_flag = high_magic_apotheosis_2
	}
	option = {
		trigger = {check_variable = { which = "spell_power" value = 4}}
		name = high_magic_lore.3000c#"High Magic; Drain Magic Power 3"
		character_event = {id = high_magic_lore.3300}
		set_character_flag = high_magic_apotheosis_3
	}
}

character_event = {
	id = high_magic_lore.3100#"High Magic; Apotheosis" 
	desc = high_magic_lore.3100_desc#"You channel the arcane powers and let it flow to your dead and dying"
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	
	immediate = {
		change_variable = {which = "spell_power" value = -2}
		set_variable = { which = miscast_power value = 2 }
		random_list = {
			75 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}			
			}
			25 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.3100a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}

			character_event = {id = high_magic_lore.31111}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.31111#Apotheosis 1" 
	desc = high_magic_lore.31111_desc#"Your spell restores those close to death or those freshly dead"
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {	
	clear_spell_effect = yes	
		random_army = { 
			limit = { 
				at_location = ROOT
				OR = {
					owner = {
						character = ROOT
					}
					leader = {
						character = ROOT
					}
				}
			}
			troops = 0.05
			morale = 0.05
		}
	}
	option = {
		name = high_magic_lore.31111a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.31111b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}





character_event = {
	id = high_magic_lore.3200#"High Magic; Drain Magic" 
	desc = high_magic_lore.3200_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -3}
		set_variable = { which = miscast_power value = 3 }
		random_list = {
			60 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}			
			}
		40 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.3200a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}


			character_event = {id = high_magic_lore.31112}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}
character_event = {
	id = high_magic_lore.31112#Drain Magic Power 2" 
	desc = high_magic_lore.31112_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes	
		random_army = { 
			limit = { 
				at_location = ROOT
				OR = {
					owner = {
						character = ROOT
					}
					leader = {
						character = ROOT
					}
				}
			}
			troops = 0.12
			morale = 0.12
		}		
	}
	
	option = {
		name = high_magic_lore.31112a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.31112b#No
		character_event = {id = magic_system.99997}
	}
}




character_event = {
	id = high_magic_lore.3300#"High Magic; Drain Magic" 
	desc = high_magic_lore.3300_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -4}
		set_variable = { which = miscast_power value = 4 }
		random_list = {
			45 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}
			}
			55 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.3300a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}

			character_event = {id = high_magic_lore.31113}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.31113#Drain Magic Power 1" 
	desc = high_magic_lore.31113_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes
		random_army = { 
			limit = { 
				at_location = ROOT
				OR = {
					owner = {
						character = ROOT
					}
					leader = {
						character = ROOT
					}
				}
			}
			troops = 0.3
			morale = 0.3
		}

	}
	
	option = {
		name = high_magic_lore.31113a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.31113b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}





#Firey_convocation


character_event = {
	id = high_magic_lore.4000#"High Magic; Firey Convocation" 
	desc = high_magic_lore.4000_desc#"Cast your powers and let lose the fires that burn perpetually.!"
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	option = {
		trigger = {check_variable = { which = "spell_power" value = 3}}
		name = high_magic_lore.4000a#"High Magic; Soul Quench 1"
		character_event = {id = high_magic_lore.4100}
		set_character_flag = high_magic_firey_convocation_1
	}
	
	option = {
		trigger = {check_variable = { which = "spell_power" value = 4}}
		name = high_magic_lore.4000b#"High Magic; Soul Quench Power 2"
		character_event = {id = high_magic_lore.4200}
		set_character_flag = high_magic_firey_convocation_2
	}
	option = {
		trigger = {check_variable = { which = "spell_power" value = 5}}
		name = high_magic_lore.4000c#"High Magic; Soul Quench Power 3"
		character_event = {id = high_magic_lore.4300}
		set_character_flag = high_magic_firey_convocation_3
	}
}

character_event = {
	id = high_magic_lore.4100#"High Magic; Soul Quench" 
	desc = high_magic_lore.4100_desc#"You channel the arcane powers and lash out towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -3}
		set_variable = { which = miscast_power value = 3 }
		random_list = {
			60 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}
			}
			40 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.4100a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.41111}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.41111#Soul Quench 1" 
	desc = high_magic_lore.41111_desc#"Your power consumes the life of your chosen target "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes
		location = {
			save_event_target_as = fieryconv
		}
		character_event = { id = high_magic_lore.41114}
		set_variable = {which = "fieryconv" value = 0}
	}
	
	option = {
		name = high_magic_lore.41111a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.41111b#No
		character_event = {id = magic_system.99997}
	}
}

character_event = {
	id = high_magic_lore.41114#Firey_convocation event 1" 
	#desc = high_magic_lore.41111_desc#"Your power consumes the life of your chosen target "
	is_triggered_only = yes
	hide_window = yes
	#picture = GFX_evt_mage_lore_high_magic
	immediate = {
		if = {
			limit = {
				NOT = { check_variable = {which = "fieryconv" value = 10}}
			}
			character_event = { id = high_magic_lore.41114 days = 1}
			change_variable = {which = "fieryconv" value = 1}
			 random_current_enemy = {
				limit = {
					any_army = {
						location = event_target:fieryconv
					}
				}
				morale = -0.01
				troops = -0.01
				random = {
					chance = 5
					leader = {
						death = yes
					}
				}
			}
				
			siege = {
				enemy = {
					morale = -0.01
					troops = -0.01
				}			
			
}
			random = {
				chance = 5
				event_target:fieryconv = {
					add_province_modifier = { modifier = magic_burning days = 30 }
				}
			}
		}	
	}
}




character_event = {
	id = high_magic_lore.4200#"High Magic; Drain Magic" 
	desc = high_magic_lore.4200_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -4}
		set_variable = { which = miscast_power value = 4 }
		random_list = {
			45 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}    				
			}
			55 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.4200a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.41112}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.41112#Soul Quench 2" 
	desc = high_magic_lore.41112_desc#"Your spell burns through the air, strike dead scores of men. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes
		location = {
			save_event_target_as = fieryconv
		}
		character_event = { id = high_magic_lore.41115}
		set_variable = {which = "fieryconv" value = 0}
	}
	
	option = {
		name = high_magic_lore.21112a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.21112b#No
		character_event = {id = magic_system.99997}
	}
}

character_event = {
	id = high_magic_lore.41115#Firey_convocation event 1" 
	#desc = high_magic_lore.41111_desc#"Your power consumes the life of your chosen target "
	is_triggered_only = yes
	hide_window = yes
	#picture = GFX_evt_mage_lore_high_magic
	immediate = {
		if = {
			limit = {
				NOT = {check_variable = {which = "fieryconv" value = 10}}
			}
			character_event = { id = high_magic_lore.41114 days = 1}
			change_variable = {which = "fieryconv" value = 1}
			 any_current_enemy = {
				limit = {
					any_army = {
						location = event_target:fieryconv
					}
				}
				morale = -0.03
				troops = -0.03
				random = {
					chance = 5
					leader = {
						death = yes
					}
				}
			}
			
#			event_target:fieryconv = {
#				any_province_character = {
#					limit = {
#						owner = {
#							is_hostile = yes
#						}
#						in_command = yes
#					}
#					troops = -0.03
#					morale = -0.03
#				}
#			}
			
		event_target:fieryconv = {				
			siege = {
				enemy = {
					morale = -0.03
					troops = -0.03
				}			
			}
		}
			random = {
				chance = 5
				event_target:fieryconv = {
					add_province_modifier = { modifier = magic_burning days = 30 }
				}
			}
		}	
	}
} 


character_event = {
	id = high_magic_lore.4300#"High Magic; Soul Quench 3" 
	desc = high_magic_lore.4300_desc#"You channel the arcane powers and lash out blindly towards the enemy."
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		change_variable = {which = "spell_power" value = -5}
		set_variable = { which = miscast_power value = 5 }
		random_list = {
			30 = {
				modifier = {
					factor = 1.1
					has_character_modifier = magic_power_1                                                                                  
				}   
				modifier = {
					factor = 1.2
					has_character_modifier = magic_power_2                                                                                  
				}    
				modifier = {
					factor = 3
					has_character_modifier = magic_power_3                                                                                  
				}    
				modifier = {
					factor = 4
					has_character_modifier = magic_power_4                                                                                  
				}    				
			}
			70 = {
				set_character_flag = miscast
			}
		}
	}
	option = {
		name = high_magic_lore.4300a#
		if = {
			limit = {
				has_character_flag = miscast
			}
			character_event = {id = magic_system.99991}#If has the miscast flag, skip to the miscast event table
			break = yes
		}
		if = {
			limit = {
				NOT = {
					has_character_flag = miscast
					any_current_enemy = {
						any_realm_character = { 
								character = event_target:magic_dispeler
							}
						}
					}
				}
			character_event = {id = high_magic_lore.41113}#If there is no one to attempt to dispell then cast the spell. 
			break = yes
		}
		event_target:magic_dispeler = {
			character_event = {id = dispell.1}#Send dueling chain event to the dispeller. 
		}
	}
}

character_event = {
	id = high_magic_lore.41113#Drain Magic Power 1" 
	desc = high_magic_lore.41113_desc#"Your spell burns through the air, taking from all enemies the ability to cast. "
	is_triggered_only = yes
	picture = GFX_evt_mage_lore_high_magic
	immediate = {
		clear_spell_effect = yes
		location = {
			save_event_target_as = fieryconv
		}
		character_event = { id = high_magic_lore.41116}
		set_variable = {which = "fieryconv" value = 0}
	}	
	
	option = {
		name = high_magic_lore.41113a#Cast Another Spell ?
		trigger = {check_variable = {which = "spell_power" value = 1}}
		long_character_event = { id = high_magic_lore.1}	
	}
	option = {
		name = high_magic_lore.41113b#No
		event_target:magic_caster = {
			character_event = { id = magic_system.99997 }
		}
	}
}

	 
character_event = {
	id = high_magic_lore.41116#Firey_convocation event 1" 
	#desc = high_magic_lore.41111_desc#"Your power consumes the life of your chosen target "
	is_triggered_only = yes
	hide_window = yes
	#picture = GFX_evt_mage_lore_high_magic
	immediate = {
		if = {
			limit = {
				NOT = {check_variable = {which = "fieryconv" value = 10}}
			}
			character_event = { id = high_magic_lore.41116 days = 1}
			change_variable = {which = "fieryconv" value = 1}
			any_current_enemy = {
				limit = {
					any_army = {
						location = event_target:fieryconv
					}
				}
				morale = -0.07
				troops = -0.07
				random = {
					chance = 10
					leader = {
						death = yes
					}
				}
			}
#			event_target:fieryconv = {
#				any_province_character = {
#					limit = {
#						owner = {
#							is_hostile = yes
#						}
#						in_command = yes
#					}
#					troops = -0.07
#					morale = -0.07
#				}
#			}
			
		event_target:fieryconv = {				
			siege = {
				enemy = {
					morale = -0.07
					troops = -0.07
				}			
			}
		}
			random = {
				chance = 10
				event_target:fieryconv = {
					add_province_modifier = { modifier = magic_burning days = 30 }
				}
			}
		}	
	}
} 

#process







